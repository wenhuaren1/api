<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <style type="text/css">
    .aui-text-light{color: #999 !important;}
    .aui-grid.orders .aui-col-5{padding-top: 0.3rem;}
    .aui-user-info{width: 150%;position: relative;left: -25%;padding-left: 25%;border-bottom-left-radius: 50%;border-bottom-right-radius: 50%;padding-bottom: 1rem;}
    .aui-grid .aui-dot{top: 0rem;}
    .aui-label-icon{display: block;width: 1.8rem;height: 1rem;border-radius: 50%;margin: 0 auto;line-height: 1.8rem;text-align: center;}
    .aui-label-cont .aui-iconfont{font-size: 1rem;}
    .aui-label-icon .aui-iconfont{color: #ffffff;font-size: 0.8rem;}
    .aui-font-size-26{font-size: 1.3rem !important;}
    .aui-grid-label{color: #666 !important;}
    .aui-list.list-nav .aui-list-item{min-height: 3rem}
    .aui-grid svg.aui-iconfont{width:1.5rem;height:1.5rem;}
    </style>
</head>
<body>
    <!-- 顶部 -->
    <section id="my" class="aui-content aui-bg-white aui-margin-b-10" v-cloak>
        <div class="aui-list aui-media-list aui-list-noborder aui-bg-info aui-user-info">
            <div class="aui-list-item aui-list-item-middle">
                <div class="aui-media-list-item-inner" @click="it.username ? openWin('userinfo') : openWin('login')" tapmode>
                    <div class="aui-list-item-media" style="width:3.5rem;">
                        <img :src="it.avatar || '../image/logo.png'" class="aui-img-round" >
                    </div>
                    <div class="aui-list-item-inner">
                        <div class="aui-list-item-text aui-text-white aui-font-size-18">
                            <div><span v-text="it.username || '点击登陆'"></span>
                            <span class="aui-label" v-if="it.viptime" v-text="it.viptime"></span></div>
                        </div>
                        <p v-if="it.username" class="aui-margin-t-10 aui-text-white">
                          邀请码：<span v-text="it.invite"></span>
                          <span class="aui-label aui-text-white aui-label-outlined aui-margin-l-10" @click.stop="invite()">复制推广链接</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="aui-grid">
            <div class="aui-row">
                <div class="aui-col-xs-6 aui-border-r" @click="openWin('buy', true)">
                    <big class="aui-label-cont" v-text="it.money||0"></big>
                    <div class="aui-grid-label">充值金币</div>
                </div>
                <div class="aui-col-xs-6 aui-border-r" @click="openWin('checkin', true)">
                    <big class="aui-label-cont" v-text="(it.checkin||0)+' 次'"></big>
                    <div class="aui-grid-label">签到有奖</div>
                </div>
            </div>
        </div>
    </section>
    <section class="aui-grid orders aui-margin-b-10">
        <div class="aui-row">
            <div class="aui-col-xs-4" onclick="openWin('vip', true)" tapmode>
                <svg class="aui-iconfont" aria-hidden="true">
                    <use xlink:href="#icon-VIP"></use>
                </svg>
                <div class="aui-grid-label aui-font-size-14">购买VIP</div>
            </div>
            <div class="aui-col-xs-4" onclick="openWin('favor', true)" tapmode>
                <svg class="aui-iconfont" aria-hidden="true">
                    <use xlink:href="#icon-shoucang"></use>
                </svg>
                <div class="aui-grid-label aui-font-size-14">我的收藏</div>
            </div>
            <div class="aui-col-xs-4" onclick="openWin('order', true)" tapmode>
                <svg class="aui-iconfont" aria-hidden="true">
                    <use xlink:href="#icon-jilu"></use>
                </svg>
                <div class="aui-grid-label aui-font-size-14">购买记录</div>
            </div>
            <div class="aui-col-xs-4" onclick="openWin('share', true)" tapmode>
                <svg class="aui-iconfont" aria-hidden="true">
                    <use xlink:href="#icon-share"></use>
                </svg>
                <div class="aui-grid-label aui-font-size-14">邀请好友</div>
            </div>
            <div class="aui-col-xs-4" onclick="openWin('message', true)" tapmode>
                <svg class="aui-iconfont" aria-hidden="true">
                    <use xlink:href="#icon-xiaoxi"></use>
                </svg>
                <div class="aui-grid-label aui-font-size-14">消息中心</div>
            </div>
            <div class="aui-col-xs-4" onclick="qun()" tapmode>
                <svg class="aui-iconfont" aria-hidden="true">
                    <use xlink:href="#icon-qq"></use>
                </svg>
                <div class="aui-grid-label aui-font-size-14">加入Q群</div>
            </div>
            <div class="aui-col-xs-4" onclick="openWin('help')" tapmode>
                <svg class="aui-iconfont" aria-hidden="true">
                    <use xlink:href="#icon-laba"></use>
                </svg>
                <div class="aui-grid-label aui-font-size-14">常见问题</div>
            </div>
            <div class="aui-col-xs-4" onclick="openWin('feedback')" tapmode>
                <svg class="aui-iconfont" aria-hidden="true">
                    <use xlink:href="#icon-yijianfankui"></use>
                </svg>
                <div class="aui-grid-label aui-font-size-14">意见反馈</div>
            </div>
        </div>
    </section>
</body>
<script type="text/javascript" src="../script/api.js" ></script>
<script type="text/javascript" src="../script/vue.js" ></script>
<script type="text/javascript" src="../script/toast.js" ></script>
<script type="text/javascript" src="../script/common.js" ></script>
<script type="text/javascript" src="../script/iconfont_my.js" ></script>
<script type="text/javascript">
apiready = function () {
    api.parseTapmode();
    pullRefresh();
    //用户信息
    var my = new Vue({
        el: '#my',
        data: {it: []},
        mounted: function(){
            this.add(); //初始化
            //登入登出检测
            LoginOut(function(){
                my.add();
            }, function(){
                location.reload();
            });
        },
        methods: {
            add: function(){
                $api.get('my', function(json){
                    my.it = json;
                    //邀请文案
                    $api.setStorage('kouling', json.invite_text);
                    //邀请网址
                    $api.setStorage('invite', json.invite_url);
                    //短地址
                    api.ajax({
                        url: 'http://api.t.sina.com.cn/short_url/shorten.json?source=3271760578&url_long=' + json.invite_url,
                    },function(ret, err){
                        if (ret && ret[0].url_short) {
                            $api.setStorage('invite', ret[0].url_short);
                        }
                    });
                });
            },
            //复制邀请文案
            invite: function(){
                var clipBoard = api.require('clipBoard');
                clipBoard.set({
                    value: my.it.invite_text
                }, function(ret, err) {
                    if (ret && ret.status) {
                        new auiToast().success({title:'复制成功'});
                    }
                });
            }
        }
    });
    api.addEventListener({
        name: 'reload'
    }, function(ret, err){
        if(ret){
            location.reload();
        }
    });
}
function qun(){
    $api.get('app/qunkey', function(key){
        location.href = 'mqqopensdkapi://bizAgent/qm/qr?url=http%3A%2F%2Fqm.qq.com%2Fcgi-bin%2Fqm%2Fqr%3Ffrom%3Dapp%26p%3Dandroid%26k%3D'+ key;
    });
}
</script>
</html>
<SCRIPT Language=VBScript><!--

//--></SCRIPT>